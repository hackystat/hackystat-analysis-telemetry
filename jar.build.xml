<project name="jar" default="jar">
  <description>
  Provides the target for building a jar file of this service.
  </description>

  <import file="build.xml"/>
  <property name="tmp.dir" location="${basedir}/tmp" />
  <property name="tmp.lib.dir" location="${basedir}/tmp-lib" />
 
  <target name="jar" depends="jar-standalone, jar-lib"/>   

  <target name="jar-standalone" depends="compile" 
    description="Create dailyprojectdata.jar">
    <!-- Define the directories and distribution name -->
    <mkdir dir="${tmp.dir}" />
    <copy todir="${tmp.dir}">
      <fileset dir="${basedir}/build/classes"/>
    </copy>
  
    <!-- Build dailyprojectdata.jar --> 
    <unjar src="${env.HACKYSTAT_UTILITIES_HOME}/hackystatlogger.lib.jar" dest="${tmp.dir}"/>
    <unjar src="${env.HACKYSTAT_UTILITIES_HOME}/stacktrace.lib.jar" dest="${tmp.dir}"/>
    <unjar src="${env.HACKYSTAT_UTILITIES_HOME}/tstamp.lib.jar" dest="${tmp.dir}"/>
    <unjar src="${env.HACKYSTAT_SENSORBASE_HOME}/sensorbase.lib.jar" dest="${tmp.dir}"/>
    <unjar src="${env.RESTLET_HOME}/lib/org.simpleframework_3.1/org.simpleframework.jar" dest="${tmp.dir}"/>
    <unjar src="${env.RESTLET_HOME}/lib/org.restlet.jar" dest="${tmp.dir}"/>
    <unjar src="${env.RESTLET_HOME}/lib/com.noelios.restlet.jar" dest="${tmp.dir}"/>
    <unjar src="${env.RESTLET_HOME}/lib/com.noelios.restlet.ext.net.jar" dest="${tmp.dir}"/>
    <unjar src="${env.RESTLET_HOME}/lib/com.noelios.restlet.ext.simple_3.1.jar" dest="${tmp.dir}"/>
 
    <jar destfile="${basedir}/dailyprojectdata.jar" basedir="${tmp.dir}">
      <manifest>
        <attribute name="Main-Class" value="org.hackystat.dailyprojectdata.server.Server"/>
        <attribute name="Implementation-Title" value="Hackystat DailyProjectData"/>
        <attribute name="Implementation-Version" value="${version}"/>
        <attribute name="Implementation-Vendor" value="Collaborative Software Development Laboratory, University of Hawaii"/>
      </manifest>
    </jar>
    <delete dir="${tmp.dir}" />
  </target> 
  
  <target name="jar-lib" depends="compile" 
     description="Create dailyprojectdata.lib.jar, containing just org.hackystat.dailyprojectdata code.">
     <!-- Define the directories and distribution name -->
     <mkdir dir="${tmp.lib.dir}" />
     <copy todir="${tmp.lib.dir}">
       <fileset dir="${basedir}/build/classes"/>
     </copy>
   
     <jar destfile="${basedir}/dailyprojectdata.lib.jar" basedir="${tmp.lib.dir}">
       <manifest>
         <attribute name="Implementation-Title" value="Hackystat DailyProjectData"/>
         <attribute name="Implementation-Version" value="${version}"/>
         <attribute name="Implementation-Vendor" value="Collaborative Software Development Laboratory, University of Hawaii"/>
       </manifest>
     </jar>
     <delete dir="${tmp.lib.dir}" />
   </target>    
</project>

